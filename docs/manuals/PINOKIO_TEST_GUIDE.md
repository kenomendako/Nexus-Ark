# 🧪 Pinokio 実機テストガイド

Nexus Ark の配布パッケージが Pinokio ブラウザ上で正しく動作するか検証するための手順書です。

## ⚠️ 重要：開始前のバックアップ
既存ユーザー（娘さん等）のPCでテストを行う際は、**作業前に必ず既存の `Nexus Ark` フォルダ全体を別の場所にコピー（バックアップ）してください。**
マイグレーション機能は安全に設計されていますが、万が一のデータ消失を防ぐためです。

---

## 🛠️ テスト環境の前提

1. **Pinokio ブラウザ**: 最新版がインストールされていること。
2. **配布用リポジトリ**: テスト対象のコードが `https://github.com/kenomendako/Nexus-Ark` (または任意のテスト用リポジトリ) の `main` ブランチにプッシュされていること。
   - ※今回は開発版 (`doc/pinokio-test-guide` ブランチの内容) を含んだビルドをプッシュしてテストします。

---


### Step 0: Pinokio ブラウザの準備
**対象: まだPinokioを持っていない方**
Pinokio は、複雑な AI アプリを「ワンクリック」でインストール・実行できる専用ブラウザです。

1. **公式サイトへアクセス**:
   - [https://pinokio.computer/](https://pinokio.computer/)
2. **ダウンロード**:
   - サイトトップの **「Download」** ボタンをクリック。
   - お使いのOS (Windows / Mac / Linux) に合わせたインストーラーをダウンロードしてください。
3. **インストール**:
   - ダウンロードしたファイルを実行し、画面の指示に従ってインストールしてください。
   - ※Windowsの場合、「WindowsによってPCが保護されました」等の警告が出ることがありますが、「詳細情報」→「実行」で進めてください。

### シナリオ A: Nexus Ark の新規インストール (Clean Install)
**目的**: 初めて使うユーザーが問題なく導入できるか確認する。


1. **GitHubリポジトリの準備**（公開用リポジトリを使用）:
   - 公開用リポジトリ `kenomendako/Nexus-Ark` を使用します。
   - ⚠️ `main` ブランチを汚さないよう、**テスト用ブランチ**（例: `test-v1`）を作成して使用することを推奨します。

   ```bash
   # 開発環境でリリースビルドを作成
   python tools/build_release.py

   # dist フォルダの中身を、公開用リポジトリの test-v1 ブランチにプッシュ
   # (手動または別フォルダで作業推奨)
   # 例:
   cd dist
   git init
   git remote add origin https://github.com/kenomendako/Nexus-Ark.git
   git checkout -b test-v1
   git add .
   git commit -m "Release Candidate Test Build"
   git push -f origin test-v1
   ```




2. **ダウンロード**:
   - Pinokio の画面上部にある検索バー/URLバーに以下の**URLを直接コピー＆ペースト**してください:
     - `https://github.com/kenomendako/Nexus-Ark/tree/test-v1`
   - **重要**: ペーストしたら、**必ず「Enter」キーを押して確定してください**。
   - ページが読み込まれ、Pinokio が `pinokio.js` を検知すると、画面右上などの目立つ位置に **「Download」** ボタンが表示されます（数秒かかる場合があります）。
   - その「Download」ボタンをクリックしてください。
2. **インストール**:
   - `Install` をクリック。
   - **🔴 チェックポイント 1 (Windows互換性)**: コンソールで `curl` コマンドエラーが出ないか？
     - Pinokio for Windows は通常 Git Bash 環境を持っていますが、もし `install.js` が失敗する場合は報告してください。
3. **起動**:
   - `Start Application` をクリック。
   - 依存ライブラリ (`uv` 経由) のインストールが自動的に行われるか確認。
4. **初期設定 (Onboarding)**:
   - WebUI が開き、APIキー設定画面（または初期設定ウィザード）が表示されるか。
   - 設定完了後、メイン画面に遷移するか。
5. **動作確認**:
   - オリヴェと会話できるか。
   - 「今のバージョンは何？」と聞いて、正しく（`APP_VERSION`）答えられるか。

### シナリオ B: アップデートと知識同期 (Update)
**目的**: 仕様書更新などが既存ユーザーに正しく反映されるか確認する。

1. **修正のシミュレーション**:
   - 手元のPC（開発機）で、仕様書（`docs/NEXUS_ARK_SPECIFICATION.md`）に些細な変更（例: 末尾に「Test Update」と追記）を加え、リポジトリにプッシュする。
2. **アップデート実行**:
   - Pinokio 上で Nexus Ark のメニューから `Update` をクリック。
   - `git pull` と `uv sync` が完了するのを待つ。
3. **確認**:
   - `Start Application` で起動。
   - `logs/app.log` またはターミナルに `Knowledge updated: ...` というログが出ているか確認。
   - オリヴェの知識フォルダ (`characters/オリヴェ/knowledge/`) 内の仕様書が更新されているか確認。
   - **重要**: ユーザーの会話ログや設定が**消えていない**ことを確認。

### シナリオ C: マイグレーション (Migration)
**目的**: 旧バージョンからのデータ移行が正しく機能するか確認する。

1. **準備**:
   - テスト対象PCに「旧バージョンの Nexus Ark フォルダ（バックアップ）」がある状態にする。
   - Pinokio で新規インストールした Nexus Ark を起動。
2. **移行実行**:
   - アプリの「設定」タブ -> 「高度な設定」 -> 「データ移行ツール」を開く（※UI未実装の場合は `tools/migrate_from_old.py` を手動実行が必要かも。要確認）。
   - **※現状の自動検知**: 起動時に旧フォルダが同階層にあれば自動でウィザードが出る設計の場合、それを確認。
   - ウィザードに従い、旧フォルダのパスを入力。
3. **確認**:
   - 旧環境の「会話ログ」が引き継がれているか（「過去ログ」として閲覧可能か）。
   - 「記憶」（Long-term memory）が反映されているか。
   - オリヴェのペルソナ設定（CSSテーマなど）が最新版（配布版）のものに統合されているか（旧データのままになっていないか、あるいは適切にマージされているか）。

---

## 🐞 不具合報告テンプレート
テストで問題が見つかった場合は、以下の情報をメモしてください。

```text
[不具合報告]
- シナリオ: (A / B / C)
- 発生タイミング: (インストール中 / 起動時 / マイグレーション中)
- エラー内容: (画面の表示 / ログの赤字)
- Pinokio環境: (Windows 10 / 11)
```
