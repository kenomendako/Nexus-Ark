# 📋 Nexus Ark タスクリスト

## 🏁 Release 1.0 (MVP) 目標
2026年2月中の安定版リリースを目指します。

## 🔴 最優先: リリースブロッカー（記憶・内省の正常化・UI不具合）

ルシアン（エージェント）の記憶の整合性と、システムプロンプトの肥大化によるコスト増を解決します。また、報告されたUIの不整合と不具合を修正します。

- [x] **[BUG] Windows配布版のRAG初期化不全とメッセージ重複の修正** <!-- id: new --> ([Report](../reports/2026-02-08_Windows_RAG_Fix.md))
  - 詳細: アプリ起動時にRAGManagerが初期化されずマイグレーションが走らない問題と、ログ削除時の重複バグを修正。
  - 優先度: 🔴最高 (Critical)

- [x] **[BUG] 「お出かけ」機能でエピソード記憶が読み込まれない** <!-- id: new --> ([Report](../reports/2026-02-06_Outing_Memory_Fix.md))
  - 詳細: エピソード記憶の月次フォルダ分割に対応しておらず、データが読み込まれない問題を修正。
  - 優先度: 🔴高

- [x] **Gemini会話ログのインポート機能** <!-- id: new -->
  - 詳細: Geminiアプリの共有リンク（PC/モバイル）から会話ログを取り込む機能を実装する。Playwright + BeautifulSoupを使用。
  - 状況: 完了。PC/モバイル短縮URL (`g.co`) 両対応済み。 ([Report](../reports/2026-02-06_Gemini_Mobile_Import.md))
  - 優先度: 🔴高

- [x] **[BUG] 設定保存通知の消失修正とルーム混線問題の調査・修正** <!-- id: 811 -->
  - 詳細:
    1. UIからの手動設定保存時にトースト通知が出ない問題を修正（自動保存は抑制のまま、手動は出す）。
    2. [Critical] スマホ等での利用時に、会話中やノート閲覧中にルームが別ルームに入れ替わってしまう「混線」バグを修正。ステート管理の見直し。
  - 優先度: 🔴最高 (Critical)
  - 関連: [おとといの修正](reports/2026-02-04_suppress_ui_announcements.md) | [完了レポート](../../docs/reports/2026-02-06_Fix_Room_State_and_Notifications.md)

- [x] **OpenAI互換モデル設定の永続化不具合修正** <!-- id: 808 -->
  - 詳細: 個別設定でOpenAI互換モデルを選択しても、再起動時にプロファイルのデフォルトモデルに戻ってしまう問題を修正。
  - 優先度: 🔴高
- [x] **[BUG] 睡眠時記憶整理のエラー修正** (High) [レポート](../reports/2026-02-04_Fix_Sleep_Memory_and_RAG_Log.md)
  - `NameError: name 'log_files' is not defined` の修正
  - RAGインデックス更新時の「空のファイルです」エラー（月次ログ対応）の修正
  - 優先度: 🔴高
- [x] **[BUG] 情景描写生成時の API キーローテーション不具合修正** <!-- id: 812 --> ([Report](../reports/2026-02-08_scenery_api_rotation_fix.md))
  - 詳細: 無料キー枯渇時に自動で代替キーへ切り替わらずにエラーになる問題を修正。
  - 優先度: 🔴高

- [x] [「### 記憶しているエンティティ一覧」をシステムプロンプトから抜く]
  - 詳細: 記憶想起に組み込んだので不要。ペンディングメッセージは分離して継続。
  - 優先度: 🔴高 
- [x] **研究ノート・創作ノートの整理** <!-- id: 803 -->
  - 詳細: ルームフォルダ直置きのノート類を整理し、分割・アーカイブ機能を実装。ツールパスの修正。
  - 状況: 完了。自動アーカイブ機能とUI閲覧機能を実装。



- [x] **推定入力トークン数の計算精度の改善** <!-- id: 802 -->
  - 詳細: 入力(推定)が実入力より大幅に大きく計算される不具合の調査と修正
  - 状況: 完了。推定値と実入力の乖離を解消し、安全なマージンを確保。

- [x] **睡眠時のRAG索引更新でのAPIキーローテーション不具合修正** <!-- id: 804 -->
  - 詳細: 睡眠時のRAG更新で429エラーが発生した際、無限リトライに陥り、再起動まで自律行動が不能になる問題を修正。
  - 状況: 完了。
- [x] **チャットログの月次分割管理の実装** <!-- id: 805 -->
  - 詳細: `log.txt` を月次単位 (`logs/YYYY-MM.txt`) で分割。過去ログのプレビュー・検索・編集機能も実装。
  - 状況: 完了。 ([レポート](reports/2026-02-03_segmented_chat_log.md), [追加レポート](reports/2026-02-03_log_management_ui.md))

- [x] [アラームメッセージが生成できていなかった問題]
  - 詳細: API枯渇ではないのに「API利用上限」のエラーメッセージが出る問題を修正し、空応答時の適切なフォールバックを実装する。
  - 状況: 完了。 ([レポート](reports/2026-02-03_alarm_generation_fix.md))
  - 優先度: 🔴高

- [x] **ルーム移動時のGradioエラー修正 (Value: 'zhipu' is not in choices)**
  - 詳細: 古いルーム設定または不整合な設定により、プロバイダ選択Radioコンポーネントで「zhipu」が不正な値としてエラーになる問題を修正。
  - 状況: 完了。 ([レポート](reports/2026-02-04_room_movement_error_fix.md))
  - 優先度: 🔴高

## 🟠 優先: リリース準備・配布基盤

一般配布に向けた基盤と、動作の透明性を確保します。

- [x] **API利用時のシステムプロンプトキャッシュ対策確認** ([レポート](reports/2026-02-03_system_prompt_caching_optimization.md))
  - 詳細: システムプロンプトの前半は変化しないものを置き、記憶想起等変化するものは後半にまとめる（Antigravity提案）
  - 優先度: 🔴高
- [x] **複数スレッドのログインポート機能** ([レポート](../../docs/reports/2026-02-04_Enhanced_Import_Features.md))
  - 詳細: 今は一つのスレッド・ファイルで1つのルームを作成しているが、複数ファイルを受け付けるようにする。ZIP対応・マルチセレクトインポート実装済み。
  - 優先度: 🔴高

- [x] **配布・運用システムの刷新** [Report](../reports/2026-02-06_Distribution_System_Update.md)
  - `uv` + `pyproject.toml` への移行
  - Pinokio対応 / オンボーディング / 知識同期ツールの実装対応)
  - [x] 配布用サンプルペルソナ（オリヴェ）の整備 [Report](../reports/2026-02-08_Olivie_Persona_Refinement.md)
  - [ ] `docs/research/配布調査.md` に基づく最新配布フローの反映
  - [ ] `version.json` によるバージョン管理の実装 <!-- id: 748 -->
- [x] **Pinokio 実機テストと配布確認** <!-- id: pinokio-test -->
  - 状態: 🚫中止 (Too Heavy)
  - 理由: 初期セットアップが一般ユーザーには困難。代替案として「Zip配布 + PowerShellランチャー」を採用。
- [x] **軽量配布パッケージ (Zip + PowerShell Launcher) の作成** <!-- id: ps-launcher -->
  - 詳細: Git/Pythonのみを前提とした、ダブルクリックで起動可能な軽量ランチャーを整備。
  - 状況: 完了。Start.bat/Start.shでuv自動インストール・起動確認済み。

- [x] **既存ユーザーのマイグレーションツールの実装** <!-- id: 813 -->
  - [x] 旧バージョン判定ロジックの実装
  - [x] データ移行スクリプト (`tools/migrate_from_old.py`) の作成
  - [x] オンボーディングウィザードへの統合（スクリプト提供完了）
  - [レポート](reports/2026-02-08_Migration_Tool_Implementation.md)
- [ ] `update_manager.py` の実装とUI統合 <!-- id: 749, 751 -->
- [x] **アラーム応答生成時のシステムプロンプト出力廃止** (High) [レポート](../reports/2026-02-04_suppress_alarm_debug_log.md)
  - 詳細: アラーム応答生成時に、デバッグモードが有効なためターミナルに全システムプロンプトが出力されるのを廃止する（通常応答と同じにする）。
  - 優先度: 🔴高
- [x] 研究・創作ノートが空の場合のアナウンス抑制 (ツール出力)
    - [x] `research_tools.py` の修正
    - [x] `creative_tools.py` の修正
    - [レポート](docs/reports/2026-02-04_suppress_empty_note_announcements.md)
- [x] **お出かけ機能エクスポートのメタタグ除去と不具合修正** (High) [レポート](../reports/2026-02-09_Outing_Export_Tag_Removal.md)
  - 詳細: エクスポートされた会話ログ・エピソード記憶から表情タグ、感情タグ、メモリトレース、思考ログを除去。除去後の不自然な改行発生バグも修正。
  - 優先度: 🔴高
- [x] 不要なUIアナウンスの抑制 (UI表示)
    - [x] `ui_handlers.py` の `gr.Info` を `print` に変更（設定保存、ログ読み込み）
    - [x] 「対象のノートは空です」のUI通知を抑制
    - [レポート](docs/reports/2026-02-04_suppress_ui_announcements.md)
  - 詳細: ツール実行結果が空の場合のアナウンスが冗長なため抑制する。
  - 優先度: 🔴高
- [ ] **ツール使用ログの常時記録**
  - [ ] 自律行動時・通常応答時だけでなく、全シーンでのツール使用をログに記録 <!-- id: 337 -->
- [ ] **Webhook管理UIの整合性確認・修正** <!-- id: 353 -->
- [ ] **内部処理モデルの設定のプロバイダ混成対応** <!-- id: 357 -->
- [x] **Supervisorモデルのハードコード解消**
  - 詳細: 定数 `SUPERVISOR_MODEL` を廃止し、共通設定の軽量モデルを使用することをログでも明確化する。 ([レポート](../reports/2026-02-05_Supervisor_Model_Fix.md))
- [x] **グループ会話Supervisor AIの安定化と一時封印（配布優先対応）** <!-- id: 809 -->
  - 詳細: 応答消失、多重ループ、設定同期不全を修正した上で、リリース安定性のため機能をUI・ロジック両面で封印。
  - レポート: [レポート](../reports/2026-02-05_Supervisor_Stability_Fix_and_Sealing.md) | [調査ログ](../technical/supervisor_issues_debug_log.md)
  - 優先度: 🔴高

## 🟡 中長期: Beyond 1.0 (リリース後)

- [ ] **グループ会話の自動継続モード** <!-- id: 810 -->
  - 詳細: ユーザー抜きでAI同士が会話を続け、ユーザーが「割り込みボタン」で発言するモード。無限ループ防止（最大ターン数）、終了条件判断が必要。
- [ ] 英語対応（UI・メニューの多言語化） <!-- id: 277 -->
- [ ] 創作ノートのRAG化 <!-- id: 296 -->
- [ ] アラームの日付指定・期間指定・祝日除外 <!-- id: 665 -->
- [ ] AIペルソナが画像を生成した際、本人がその画像を確認できるようにする <!-- id: 801 -->
  - 詳細: 生成された画像のパスをAPIパーツとして含め、AIが自分の描いた絵を「見る」ことができるようにする
- [ ] 年次反省（Annual Reflection）の追加 <!-- id: 535 -->
- [ ] 忘却機能（ガベージコレクション）の設計 <!-- id: 675 -->
- [ ] スーパーツール化によるトークン削減の検討 <!-- id: 597 -->

---
- [x] **APIコストの最適化（スリム化）** ([レポート](reports/2026-02-02_API_Cost_Optimization.md)) ✅
- [x] **UIクリーンアップと「文字置き換え」不具合修正** ([レポート](reports/2026-02-02_UI_Cleanup_and_Markdown_Fix.md)) ✅
- [x] **APIキーローテーションの最適化と個別設定リセットの修正** ([レポート](reports/2026-02-02_Fix_Settings_and_API_Rotation.md)) ✅
- [x] **Arousal 整合性改善と UI クリーンアップ** ([レポート](reports/2026-02-02_SessionArousal_Fixes.md)) ✅
- [x] **表情管理システムの洗練とプロンプト同期の改善** ([レポート](reports/2026-02-02_refine_avatar_expressions.md)) ✅
- [x] **記憶・内省システムの緊急修正**（バグ修正・ロジック刷新） ✅
- [x] **応答再生成時の添付ファイル復元** ([レポート](reports/2026-02-01_regeneration_attachment_fix.md)) ✅
- [x] **内省・記憶システムの安定化とルシアンの記憶修復** ([レポート](reports/2026-02-01_memory_stabilization.md)) ✅
- [x] **APIキーローテーションの信頼性向上**（無料キー優先・永続化） ✅
- [x] **RAG モデル不整合対策と内部処理モデルの最適化** ✅
- [x] **エンティティ記憶の洗練（常体統一・重複排除）** ✅
- [x] **APIキーローテーションの高速化（429 発生時の冗長リトライ削減）** ✅
- [x] **研究ノート・創作ノートの整理** ([レポート](reports/2026-02-02_implement_note_organization.md)) ✅
- [x] <!-- id: 806 --> RAG検索時のAPIキーローテーション不具合修正 [Report](docs/reports/2026-02-03_rag_key_rotation_rescue_fix.md)
- [x] **APIキーローテーション挙動の調査と確認** <!-- id: 807 -->
   - 詳細: 無料キー枯渇時の有料キーへのフォールバックと、回復時の挙動（無料キーへの復帰）を確認。UI表示との整合性についてユーザー合意済み。
---
## 🗄️ アーカイブ
[全タスク履歴・アーカイブはこちら](ARCHIVE_TASK_LIST.md)
