# 仕様書更新レポート

**日付:** 2026-02-07  
**ブランチ:** `docs/update-specification`  
**ステータス:** ✅ 完了

---

## 問題の概要

Nexus Arkの機能仕様書（`docs/NEXUS_ARK_SPECIFICATION.md`）が現行実装に対して大幅に未記載の状態だった。オリヴェ（ペルソナ）がRAG経由でユーザーの質問に答えるためには、正確で最新の仕様書が必要。

---

## 修正内容

### 1. 仕様書の大幅拡充（約250行 → 480行超）
約30以上の未記載機能を追記：
- **記憶・内省システム**: Arousalベース記憶、階層的エピソード記憶圧縮、内省機能（目標・未解決の問い・夢日記）、エンティティ記憶v2、研究・創作ノート
- **自律行動システム**: 4ドライブ（退屈・好奇心・目標欲・関係性維持）、睡眠時処理、ノート管理
- **AIプロバイダ対応**: マルチプロバイダ（OpenAI互換・ローカルLLM）、APIキーローテーション、画像生成マルチプロバイダ
- **UI/UX**: オンボーディングウィザード、月次ログ管理、ルーム別CSSテーマ、表情差分システム、チェス機能
- **時間管理・Web連携**: ウォッチリスト監視、Gemini URLインポート、プロジェクトファイル探索

### 2. ユーザーフィードバック10項目の反映
| 項目 | 対応 |
|------|------|
| MP4送信制限 | 注記追加 |
| ログ編集 | ログ管理タブ追記 |
| ストリーミング | Gemini 3.0 Flash + ツール時は自動無効化の説明に修正 |
| Geminiインポート | お出かけ機能→帰宅タブに修正 + INBOX追記 |
| 内部処理モデル | 選択ガイド追加 |
| 検索プロバイダ | 新セクション§5.1.4追加 |
| Arousal表示 | 誤記削除（UI表示なし、内部処理に修正） |
| 本日分要約 | 両モードで要約される旨に修正 |
| RAG索引 | Embeddingモデル変更時の注意追加 |
| 思考プロセス | 二幕構成→ツール先行原則に修正 |

### 3. その他の修正
- バージョン表示の「(Beta)」二重表示を修正（`nexus_ark.py`）
- v0.9.0新機能サマリーセクション（§15）を追加
- モデル名を最新版（gemini-3-flash-preview、gemini-2.5-flash-lite）に更新

---

## 変更したファイル

- `docs/NEXUS_ARK_SPECIFICATION.md` - 仕様書の大幅更新（約250行→480行超）
- `nexus_ark.py` - バージョン表示の重複修正
- `docs/INBOX.md` - Geminiインポート統合リクエスト追記
- `docs/plans/DISTRIBUTION_CHECKLIST.md` - 仕様書更新タスクを完了マーク

---

## 検証結果

- [x] 仕様書の構文確認（マークダウン形式）
- [x] セクション番号の連続性確認
- [x] コード調査によるストリーミング自動OFF動作の確認（gemini_api.py:871）
- [x] ユーザーレビュー後の追加修正反映

---

## コミット履歴

1. `docs: 仕様書を現行実装に合わせて大幅更新`
2. `fix: バージョン表示の(Beta)二重表示を修正 + 仕様書にv0.9.0新機能セクション追加`
3. `docs: 仕様書フィードバック10項目を反映`
4. `docs: 仕様書の追加修正`
5. `docs: モデル名をgemini-2.5系に統一（ユーザー修正）`

---

## 残課題

なし（INBOXに「外部ログインポートへのGeminiインポート機能追加」を将来タスクとして登録済み）
