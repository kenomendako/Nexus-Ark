# v0.2.1 ホットフィックス完了レポート

**日付:** 2026-02-10  
**ブランチ:** `fix/v0.2.1-hotfix-installation-and-api`  
**ステータス:** ✅ 完了

---

## 問題の概要

v0.2.0 リリース直後に報告された、Windows環境でのインストール失敗、APIキー枯渇時の無応答、およびUI表示の不整合を包括的に修正しました。

---

## 修正内容

1. **Windowsインストールエラー（ValueError）の解消**
   - `pyproject.toml` に `package = false` を設定。これにより `hatchling` が不要なビルド試行を行わなくなり、一部のWindows環境で `uv sync` が失敗する問題を解決しました。

2. **API枯渇時の無応答不具合の修正**
   - APIキーが完全に枯渇した際、エラーメッセージ単体ではなく「過去の履歴＋エラーメッセージ」を返すように修正。UI側でメッセージが破棄されるのを防ぎ、適切にエラーが表示されるようにしました。

3. **履歴ロード順序による過去ログ流出の修正**
   - API枯渇チェックなどの「早期リターン」が発生する前に、履歴のフィルタリング（本日分のみ等）を行うようにロジックを再編。エラー時に意図しない過去の大量ログがUIに表示される問題を根本解決しました。

4. **Python 3.14 互換性問題の解決（ビルドエラー回避）**
   - スクリーンショットで報告された「Python 3.14 環境での `pydantic-core` ビルド失敗」に対応。
   - `pyproject.toml` の `requires-python` を `<3.14` に制限し、かつ `.python-version` ファイルを配置して `uv` が安定版（3.12）を優先的に使用するように設定しました。

---

## 変更したファイル

- `pyproject.toml` - `package = false` 設定追加、Python バージョン制限追加
- `.python-version` - 安定版 Python 3.12 を指定
- `gemini_api.py` - 履歴構築・フィルタリング・エラー返却ロジックの改善
- `ui_handlers.py` - 初期化完了ガードによる通知抑制の強化
- `docs/plans/TASK_LIST.md` - タスク完了マーク

---

## 検証結果

- [x] アプリ起動確認：正常（通知の抑制を確認）
- [x] 機能動作確認：API枯渇時に適切にエラーが表示され、過去ログが重複しないことをロジック上で確認
- [x] 依存関係解消：Windows 11 (WSL2) / Windows環境想定での `uv sync` 設定整合性を確認
- [x] UI Wiring検証：既存の警告を除き、追加の不整合がないことを確認

---

## 残課題（あれば）

- チャットログの全読み込みによるパフォーマンス負荷：将来的に「最新1ヶ月分のみ」のロードへの最適化を検討。

---
