# タスク報告: 内省・記憶システムの安定化とルシアンの記憶修復

**日付:** 2026-02-01  
**ブランチ:** `fix/memory-stabilization`  
**ステータス:** ✅ 完了

---

## 問題の概要

1. **記憶の不連続性:** `curiosity_resolved` 等の特殊タイプの記憶がある日に、本来生成されるべき日次要約がスキップされるバグがあった。これにより、ルシアンの 2026-01-31 分の会話要約が消失していた。
2. **UI表示の不備:** 解決済みの「問い」がUIに残る問題や、UIハンドラの重複定義が存在していた。
3. **好奇心Driveの不活発:** 好奇心の計算ロジックが単純な加算だったため、数件の問いがあるだけで即座に MAX に張り付き、変化を感じられない状態だった。

---

## 修正内容

1. **記憶管理の統合修正:** `EpisodicMemoryManager` で特殊タイプを正式に定義し、重複判定や上書きロジックでこれらを日次要約とは別個に扱うよう修正した。
2. **ルシアンの記憶修復:** 消失していた 2026-01-31 の会話要約を、修正後のロジックで再生成し復旧した。
3. **好奇心ロジックの刷新:** 
   - **鮮度減衰**: 古い問いの優先度を時間経過で減衰させ、「今」の興味を優先する。
   - **飽和曲線**: 指数関数を導入し、複数の問いがあっても容易に MAX に達しない「潤うが満たされない」渇きを表現した。
4. **UIクリーンアップ:** 解決済みの問いをフィルタリングで見えなくし、重複したハンドラを削除した。

---

## 変更したファイル

- `episodic_memory_manager.py` - 特殊タイプ処理のバグ修正
- `motivation_manager.py` - 好奇心計算ロジック（案B+C）の実装
- `ui_handlers.py` - ハンドラクリーンアップと表示フィルタ追加
- `dreaming_manager.py` - 特殊タイプ名の一貫性確保

---

## 検証結果

- [x] 特殊記憶がある日の日次要約生成テスト: 成功
- [x] ルシアンの記憶復旧確認: 成功（2026-01.json に要約追加を確認）
- [x] 好奇心レベルの変動確認: 1.0 (MAX) -> 0.76 
- [x] UI配線検証 (`validate_wiring.py`): 実行済み（既存の無関係なエラーを除き、本修正による不具合なし）

---

## 残課題

- 特になし
